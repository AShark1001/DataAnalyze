{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block body %}
    <script src="https://cdn.plot.ly/plotly-1.8.0.min.js"></script>
    <script>
        var rawDataURL = 'https://raw.githubusercontent.com/plotly/datasets/master/2016-weather-data-seattle.csv';
        var xField = 'Date';
        var yField = 'Mean_TemperatureC';

        var selectorOptions = {
            buttons: [{
                step: 'all',
            }],
        };

        Plotly.d3.csv(rawDataURL, function(err, rawData) {
            if(err) throw err;

            var data = prepData(rawData);
            var layout = {
                title: 'Time series of {{ cur_file_name }}',
                xaxis: {
                    rangeselector: selectorOptions,
                    rangeslider: {}
                },
                yaxis: {
                    fixedrange: true
                }
            };

            Plotly.plot('graph', data, layout);
        });

        function prepData(rawData) {
            var x = [];
            var y = [];

            console.log(rawData.length)

            rawData.forEach(function(datum, i) {
                if(i % 100) return;

                x.push(new Date(datum[xField]));
                y.push(datum[yField]);
            });

            return [{
                mode: 'lines',
                x: x,
                y: y
            }];
        }
    </script>

    <div class="row">
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
            Add a graph
        </button>
    </div>

    <div class="row">
        {{ data }}
    </div>

    <div class="row">
        <div id="graph"></div>
    </div>

    <div class="modal fade" tabindex="-1" role="dialog" id="exampleModal" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title d-inline" style="display: inline">Select a column</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-group">
                <label for="columnSelect">Column: </label>
                <select class="form-control" id="columnSelect">
                    {% for col in columns %}
                        <option value="{{ col.col_idx }}">{{ col.text }}</option>
                    {% endfor %}
                </select>
              </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="addGraph()">Ok</button>
          </div>
        </div>
      </div>
    </div>

    <script>
        function addGraph() {
            console.log($('#columnSelect').val());
        }
    </script>

{% endblock %}
